import{r as n,G as M,j as e,I as x,i as _,c as f,u as y}from"./index-ChxEb-0n.js";import{B as E,c as I}from"./Breadcrumbs-D_HRNiOS.js";import{L as T}from"./Loader-BFLVQ2Wj.js";import{P as B}from"./ProductsList-BJEOeCz1.js";import"./ProductCard-Bg8sMIz_.js";const N=n.memo(({label:c,selected:i,options:s,onChange:r})=>{const{theme:t}=n.useContext(M),[o,l]=n.useState(!1),u=n.useRef(null);n.useEffect(()=>{const d=j=>{u.current&&!u.current.contains(j.target)&&l(!1)};return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[]);const p=n.useCallback(()=>l(d=>!d),[]),a=n.useCallback(d=>{r(d),l(!1)},[r]);return e.jsxs("div",{ref:u,className:"dropdown",children:[e.jsx("div",{className:"dropdown__label",children:c}),e.jsxs("button",{className:`dropdown__button ${o?"dropdown__button--open":""}`,onClick:p,children:[e.jsx("div",{className:"dropdown__title",children:i}),e.jsx("div",{className:"dropdown__icon",children:e.jsx(x,{icon:o?_.arrow_down[t]:_.arrow_right[t]})})]}),o&&e.jsx("ul",{className:"dropdown__options",children:s.map(d=>e.jsx("li",{className:"dropdown__option",onClick:()=>a(d),children:d},d))})]})});N.displayName="Dropdown";const O=(c,{sortBy:i,query:s})=>{let r=[...c];switch(s&&(r=r.filter(t=>t.name.toLowerCase().includes(s.toLowerCase().trim()))),i){case"Newest":return r.sort((t,o)=>o.year-t.year);case"Alphabetically":return r.sort((t,o)=>t.name.localeCompare(o.name));case"Ceapest":return r.sort((t,o)=>t.fullPrice-o.fullPrice);default:return r}},P=4,R=({total:c,perPage:i,currentPage:s,onPageChange:r})=>{const{theme:t}=n.useContext(M),o=n.useMemo(()=>Math.ceil(c/i),[i,c]),[l,u]=n.useMemo(()=>{let p=Math.max(1,s-1),a=Math.min(o,s+2);return a-p+1<P&&(p===1?a=Math.min(o,p+P-1):p=Math.max(1,a-P+1)),[p,a]},[s,o]);return e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:f("pagination__button",{"pagination__button--disabled":s===1}),onClick:()=>r(s-1),disabled:s===1,children:s===1?e.jsx(x,{icon:_.arrow_left__disabled[t]}):e.jsx(x,{icon:_.arrow_left[t]})}),e.jsx("div",{className:"pagination__button-container",children:Array.from({length:u-l+1},(p,a)=>e.jsx("button",{className:f("pagination__button-page",{"pagination__button-page--active":s===l+a}),onClick:()=>r(l+a),children:l+a},l+a))}),e.jsx("button",{className:f("pagination__button",{"pagination__button--disabled":s===o}),onClick:()=>r(s+1),disabled:s===o,children:s===o?e.jsx(x,{icon:_.arrow_right__disabled[t]}):e.jsx(x,{icon:_.arrow_right[t]})})]})};function C(c,i){const s=new URLSearchParams(c.toString());return Object.entries(i).forEach(([r,t])=>{t===null?s.delete(r):Array.isArray(t)?(s.delete(r),t.forEach(o=>{s.append(r,o)})):s.set(r,t)}),s.toString()}const U=({category:c})=>{const{allProducts:i}=n.useContext(M),[s,r]=n.useState(!1),[t,o]=n.useState(null),[l,u]=y(),p=l.get("sort")||"Newest",a=l.get("perPage")||"All",d=Number(l.get("page"))||1,j=n.useMemo(()=>i.filter(m=>m.category===c),[i,c]),h=n.useMemo(()=>O(j,{sortBy:p}),[j,p]),g=h.length,S=n.useMemo(()=>a==="All"?1:Math.ceil(g/+a),[g,a]),w=n.useMemo(()=>(d-1)*+a,[d,a]),v=n.useMemo(()=>a==="All"?h:h.slice(w,w+ +a),[a,w,h]),A=n.useCallback(m=>{u(C(l,m==="Newest"?{sort:null}:{sort:m}))},[l,u]),L=n.useCallback(m=>{u(C(l,m==="All"?{perPage:null,page:null}:{perPage:m,page:"1"}))},[l,u]),k=n.useCallback(m=>{const b=m===1?{page:null}:{page:String(m)};u(C(l,b))},[l,u]);return n.useEffect(()=>{r(!0),o(null);const m=setTimeout(()=>{try{(!i||i.length===0)&&o("Failed to load products")}catch{o("Failed to load products")}finally{r(!1)}},500);return()=>clearTimeout(m)},[c,i]),e.jsxs("div",{className:"productPage",children:[s&&e.jsx(T,{}),!s&&t&&e.jsxs("div",{className:"productPage__error",children:[e.jsx("p",{children:"Something went wrong. Please try again."}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Reload"})]}),!s&&!t&&!h.length&&e.jsx("div",{className:"productPage__no-products",children:e.jsxs("p",{children:["There are no ",c," yet."]})}),!s&&!t&&h.length?e.jsxs(e.Fragment,{children:[e.jsx(E,{productType:c}),e.jsx("h1",{className:"productPage__title",children:c&&`${I(c)} page`}),e.jsx("span",{className:"productPage__description",children:`${g} model${g!==1?"s":""}`}),e.jsxs("div",{className:"productPage__dropdown",children:[e.jsx("div",{className:"productPage__dropdown--sortBy",children:e.jsx(N,{label:"Sort by",selected:p,options:["Newest","Alphabetically","Cheapest"],onChange:A})}),e.jsx("div",{className:"productPage__dropdown--itemsPerPage",children:e.jsx(N,{label:"Items on page",selected:a,options:["4","8","16","All"],onChange:L})})]}),e.jsx(B,{products:v,displayType:"with-discount"}),a!=="All"&&S>1&&e.jsx(R,{total:g,perPage:+a,currentPage:d,onPageChange:k})]}):null]})};export{U as ProductPage};
